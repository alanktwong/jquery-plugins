<!DOCTYPE HTML>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<title>jQuery Publish/Subscribe: Data Demo Page</title>

<script type="text/javascript"  src="http://www.google.com/jsapi"></script>
<script type="text/javascript">
  google.load("jquery", "1.7.1", {uncompressed: true});
</script>

<script type="text/javascript" src="../../../common.js"></script>
<script type="text/javascript" src="../../jquery.pubsub.js"></script>
<script>
$(document).ready(function() {
	// data can be expected as an object literal / hash
	$.subscribe( "dataexample", function( data ) {
		$( "p#receiver" ).append( "dataexample: " + data.foo ); // bar
	});

	// or individual parameters.
	$.subscribe( "dataexample2", function( param1, param2 ) {
		$( "p#receiver2" ).append( "dataexample2: " + param1 + param2 ); // barbaz
	});

	$.publish( "dataexample", { foo: "bar" } );
	$.publish( "dataexample2", "bar", "baz" );
	
	
	function asyncEvent(){
	    var dfd = new $.Deferred();

	    // Resolve after a random interval
	    setTimeout(function(){
	        dfd.resolve("hurray");
	    }, Math.floor(400+Math.random()*2000));

	    // Reject after a random interval
	    setTimeout(function(){
	        dfd.reject("sorry");
	    }, Math.floor(400+Math.random()*2000));

	    // Show a "working..." message every half-second
	    setTimeout(function working(){
	        if ( dfd.state() === "pending" ) {
	            dfd.notify("working... ");
	            setTimeout(working, 500);
	        }
	    }, 1);

	    // Return the Promise so caller can't change the Deferred
	    return dfd.promise();
	};
	$.when( asyncEvent() ).then(
		    function(status){
	          $("#receiver4").append( status+', things are going well' );
		    },
		    function(status){
		        $("#receiver4").append( status+', you fail this time' );
		    },
		    function(status){
		        $("#receiver3").append(status);
		    }
	);

});
</script>
</head>
<body>
	<h3>jQuery PubSub: Data Usage</h3>
	<div id="note">
		<p>Under jQuery 1.4.4, only synchronous part of demo works</p>
		<p>Under jQuery 1.7.1, asynchronous part of demo also works</p>
	</div>
	<div id="console-log" style="font-size: 14px;">
		<p id="receiver"></p>
		<p id="receiver2"></p>
		<p id="receiver3"></p>
    <p id="receiver4"></p>
	</div>
</body>

</html>