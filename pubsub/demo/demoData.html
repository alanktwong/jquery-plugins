<!DOCTYPE HTML>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<title>jQuery Publish/Subscribe: Data Demo Page</title>

	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.js"></script>
	<!--
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.js"></script>
	-->
	
	<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.3/underscore-min.js"></script>
	<script type="text/javascript" src="../../jquery.pubsub.js"></script>
	<script type="text/javascript" src="../../../log4jq/jquery.log4jq.js"></script>
<script>
$(document).ready(function() {
	var logger = $.configureLog4jq({
		enabled: true,
		level : "debug",
		targets : [
			{
				name: "console",
				subscribed: true
			}
		]
	});
	var log = function(msg) {
		$.debug(msg);
	};
	
	
	var topic1 = "/dataexample/1";
	var topic2 = "/dataexample/2";
	// data can be expected as an object literal / hash
	$.subscribe( topic1, function( n ) {
		var msg =   topic1 + " : " + n.data.foo  ;
		$( "#receiver",'#console-log' ).append( msg );
		log(msg);
	});

	// or individual parameters.
	$.subscribe( topic2, function( n ) {
		var msg =  topic2 + " : " + n.data.param1 + n.data.param2 ;
		$( "#receiver2", '#console-log' ).append(msg);
		log(msg);
	});

	var createHandlers = function(topic) {
		return {
			progress: function() {
				log("begin " + topic);
			},
			done: function() {
				log("done " + topic);
			},
			fail: function() {
				log("fail " + topic);
			},
			always: function() {
				log("always " + topic);
			}
		};
	};
	
	var $note = $('#note').click(function(evt) {
		var sync = true;
		if (sync) {
			$.publishSync( topic1, $.extend({data : {foo: "bar" }}, createHandlers(topic1)));
			$.publishSync( topic2, $.extend({data :  {param1 : "bar", param2: "baz"}}, createHandlers(topic2)));
		} else {
			$.publish( topic1, $.extend({data : {foo: "bar" }}, createHandlers(topic1)));
			_.delay(function() {},10);
			$.publish( topic2, $.extend({data : {param1 : "bar", param2: "baz"}}, createHandlers(topic2)));
		}
	});
	$note.click();
});
</script>
</head>
<body>
	<h3>jQuery PubSub: Data Usage</h3>
	<div id="note">
		<p>Only synchronous part of demo works for co-publishing</p>
		<p>Asynchronous part of demo does not work for co-publishing</p>
	</div>
	<div id="console-log" style="font-size: 14px;">
		<p id="receiver"></p>
		<p id="receiver2"></p>
		<p id="receiver3"></p>
		<p id="receiver4"></p>
	</div>
</body>

</html>