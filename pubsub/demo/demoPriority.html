<!DOCTYPE HTML>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<title>jQuery Publish/Subscribe: Priority Demo Page</title>

	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.js"></script>
	<!--
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.js"></script>
	-->
	
	<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.3/underscore-min.js"></script>
	<script type="text/javascript" src="../../jquery.pubsub.js"></script>
	<script type="text/javascript" src="../../../log4jq/jquery.log4jq.js"></script>
<script>
$(document).ready(function() {
	var logger = $.configureLog4jq({
		enabled: true,
		level : "debug",
		targets : [
			{
				name: "console",
				subscribed: true
			}
		]
	});
	var log = function(msg) {
		$.debug(msg);
	};
	
	
	var topic = "/priority/example";
	// we can subscribe to a topic with a priority
	$.subscribe( topic, function( n ) {
		var data = n.data;
		$( "#receiver2" ).append( "\n 2nd highest priority: " + data.foo + "\n" );
	}, 2 );

	// we can use the highest priority possibly
	// keep other subscriptions from firing.
	$.subscribe( topic, function( n ) {
		var data = n.data;
		$( "#receiver" ).append( "\n highest priority:" + data.foo + "\n" );
		if ( data.foo === "oops" ) {
			$( "#oops" ).append( "\n received oops:" + data.foo + "\n" );
			return false;
		}
	}, 1 );

	// the default priority is '10'.
	$.subscribe( topic, function( n ) {
		var data = n.data;
		$( "#receiver3" ).append( "\n default priority is 10: " + data.foo+ "\n" );
	});
	var createHandlers = function(topic) {
		return {
			progress: function() {
				log("begin " + topic);
			},
			done: function() {
				log("done " + topic);
			},
			fail: function() {
				log("fail " + topic);
			},
			always: function() {
				log("always " + topic);
			}
		};
	};
	
	var sync = true;
	if (sync) {
		$.publishSync( topic, $.extend({data : {foo: "bar" }}, createHandlers("pub of 'bar'")) );
		$.publishSync( topic, $.extend({data : {foo: "oops"}}, createHandlers("pub of 'oops'")) );
	} else {
		$.publish( topic, $.extend({data : {foo: "bar" }}, createHandlers("pub of 'bar'")) );
		$.publish( topic, $.extend({data : {foo: "oops"}}, createHandlers("pub of 'oops'")) );
	}
});
</script>
</head>
<body>
	<h3>jQuery PubSub: Priority Usage</h3>
	<div id="note">
		<p>Only synchronous part of demo works for co-publishing</p>
		<p>Asynchronous part of demo does not work for co-publishing</p>
	</div>
	<div id="console-log" style="font-size: 14px;">
		<p id="receiver"></p>
		<p id="receiver2"></p>
		<p id="receiver3"></p>
		<p id="oops"></p>
	</div>
</body>

</html>